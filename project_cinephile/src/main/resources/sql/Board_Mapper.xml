<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org//DTD Config 3.0//EN" 
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.cine.board">


<!-- resultMap: property(dto의 멤버필드), column(DB컬럼명)
	<resultMap type="com.project.cine.BoardDto" id="BoardDtoMap">
		<result property="w_seq" column="W_SEQ"/>
		<result property="id" column="ID"/>
		<result property="w_title" column="W_TITLE"/>
		<result property="w_content" column="W_CONTENT"/>
		<result property="w_regdate" column="W_REGDATE"/>
		<result property="w_ref" column="W_REF"/>
		<result property="w_reply" column="W_REPLY"/>
		
	<collection property="loginDto" resultMap="loginDtoMap" />
	</resultMap>
 -->	
	<select id="getAllList" resultType="BoardDto">
		SELECT W_SEQ, ID, W_TITLE, W_CONTENT, W_REGDATE, W_REF, W_DELFLAG,
			W_REPLY
			FROM MINFO_BOARD 
			ORDER BY W_REF
	</select>


	<insert id="insertBoard" parameterType="BoardDto">
		INSERT INTO MINFO_BOARD VALUES (MINFO_BOARD_w_seq.NEXTVAL, #{id},#{w_title},#{w_content},SYSDATE,(SELECT NVL(MAX(w_ref)+1,0) FROM MINFO_BOARD),0,0,'N','N')
	</insert>
	
	<update id="boardUpdateBoard" parameterType="BoardDto">
		UPDATE MINFO_BOARD SET W_TITLE=#{w_title},W_CONTENT=#{w_content}
		, W_REGDATE=SYSDATE WHERE W_SEQ=#{w_seq} 
	</update>
	
	
	<update id="muldel" parameterType="map">
		UPDATE MINFO_BOARD SET W_DELFLAG='Y'
		WHERE W_SEQ IN
		<foreach collection="w_seqs" open="(" close=")"
		          separator="," item="w_seq" >
			#{w_seq}
		</foreach>
	</update>
	
	
	<update id="readCount" parameterType="int">
		 UPDATE MINFO_BOARD SET W_READCOUNT=W_READCOUNT+1  
				  WHERE W_SEQ=#{w_seq} 
	</update>
	
	
	<update id="replyUpdate" parameterType="BoardDto">
		 UPDATE MINFO_BOARD SET STEP=STEP+1  
		 WHERE W_REF=(SELECT W_REF FROM MINFO_BOARD WHERE W_SEQ=#{w_seq}) 
		 AND STEP > (SELECT STEP FROM MINFO_BOARD WHERE W_SEQ=#{w_seq}) 
	</update>
	
	
	<insert id="replyInsert" parameterType="BoardDto">
		 INSERT INTO MINFO_BOARD  
		 VALUES (MINFO_BOARD_W_SEQ.nextval,#{id},#{title},#{content},SYSDATE  
				,(SELECT W_REF FROM MINFO_BOARD WHERE W_SEQ=#{w_seq})   
				,(SELECT STEP FROM MINFO_BOARD WHERE W_SEQ=#{w_seq})+1  
				,(SELECT DEPTH FROM MINFO_BOARD WHERE W_SEQ=#{w_seq})+1  
				,0,'N')
	</insert>	
	
</mapper>

